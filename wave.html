<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Wave Precision</title>
    <style>
        body {
            margin: 0;
            background: #0b0f1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            color: white;
            font-family: Arial, sans-serif;
        }

        canvas {
            background: #0f1424;
            border: 2px solid #2a335a;
        }

        .ui {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 18px;
        }
    </style>
</head>

<body>

    <div class="ui">
        Score: <span id="score">0</span>
    </div>

    <canvas id="game" width="900" height="500"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');

        // ─────────────────────────────
        // PLAYER (WAVE)
        // ─────────────────────────────
        const player = {
            x: 150,
            y: canvas.height / 2,
            size: 6,
            diagonalSpeed: 4,
            direction: 1 // 1 = up, -1 = down
        };

        // ─────────────────────────────
        // COULOIR
        // ─────────────────────────────
        let corridorGap = 90;
        let corridorCenterY = canvas.height / 2;
        let corridorDirection = 1;

        let topPath = [];
        let bottomPath = [];

        const obstacleSpeed = 3;

        // ─────────────────────────────
        // GAME STATE
        // ─────────────────────────────
        let running = false;
        let score = 0;

        // ─────────────────────────────
        // INPUT
        // ─────────────────────────────
        window.addEventListener('mousedown', () => player.direction = -1);
        window.addEventListener('mouseup', () => player.direction = 1);

        window.addEventListener('keydown', e => {
            if (e.code === 'Space') player.direction = -1;
        });

        window.addEventListener('keyup', e => {
            if (e.code === 'Space') player.direction = 1;
        });

        // ─────────────────────────────
        // INIT
        // ─────────────────────────────
        function startGame() {
            running = true;
            score = 0;
            player.y = canvas.height / 2;

            corridorCenterY = canvas.height / 2;
            corridorDirection = 1;

            topPath = [];
            bottomPath = [];

            for (let x = canvas.width; x >= -50; x -= 10) {
                topPath.push({ x, y: corridorCenterY - corridorGap / 2 });
                bottomPath.push({ x, y: corridorCenterY + corridorGap / 2 });
            }

            requestAnimationFrame(loop);
        }

        // ─────────────────────────────
        // UPDATE
        // ─────────────────────────────
        function update() {
            if (!running) return;

            // player movement
            player.y += player.direction * player.diagonalSpeed;

            // corridor vertical movement (same angle as wave)
            corridorCenterY += corridorDirection * player.diagonalSpeed;

            if (corridorCenterY - corridorGap / 2 < 50) corridorDirection = 1;
            if (corridorCenterY + corridorGap / 2 > canvas.height - 50) corridorDirection = -1;

            // move corridor horizontally
            topPath.forEach(p => p.x -= obstacleSpeed);
            bottomPath.forEach(p => p.x -= obstacleSpeed);

            // extend corridor to the right
            while (topPath[topPath.length - 1].x < canvas.width) {
                const lastX = topPath[topPath.length - 1].x + 10;
                topPath.push({ x: lastX, y: corridorCenterY - corridorGap / 2 });
                bottomPath.push({ x: lastX, y: corridorCenterY + corridorGap / 2 });
            }

            // cleanup
            topPath = topPath.filter(p => p.x > -20);
            bottomPath = bottomPath.filter(p => p.x > -20);

            // collision
            for (let i = 0; i < topPath.length; i++) {
                if (Math.abs(topPath[i].x - player.x) < 5) {
                    if (
                        player.y - player.size < topPath[i].y ||
                        player.y + player.size > bottomPath[i].y
                    ) {
                        running = false;
                    }
                }
            }

            score++;
            scoreEl.textContent = score;
        }

        // ─────────────────────────────
        // DRAW
        // ─────────────────────────────
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // corridor
            ctx.strokeStyle = '#ff4d4d';
            ctx.lineWidth = 2;

            ctx.beginPath();
            topPath.forEach((p, i) => {
                if (i === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            });
            ctx.stroke();

            ctx.beginPath();
            bottomPath.forEach((p, i) => {
                if (i === 0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            });
            ctx.stroke();

            // player
            ctx.fillStyle = '#00eaff';
            ctx.beginPath();
            ctx.moveTo(player.x, player.y);
            ctx.lineTo(player.x - player.size, player.y - player.size);
            ctx.lineTo(player.x - player.size, player.y + player.size);
            ctx.closePath();
            ctx.fill();
        }

        // ─────────────────────────────
        // LOOP
        // ─────────────────────────────
        function loop() {
            update();
            draw();

            if (running) {
                requestAnimationFrame(loop);
            } else {
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.fillText('Game Over', canvas.width / 2 - 80, canvas.height / 2);
            }
        }

        // ─────────────────────────────
        // START
        // ─────────────────────────────
        startGame();
    </script>

</body>

</html>