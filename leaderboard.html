<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Classements - SV CHALLENGE LIST</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="leaderboard.css">
    <link rel="stylesheet" href="dark-mode.css">
    <link rel="stylesheet" href="mobile-optimized.css">
    <!-- Supabase Storage (Supabase + localStorage fallback) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="storage-adapter.js"></script>
    <script src="supabase-config.js"></script>
    <script>
        // Initialiser Supabase PUIS le stockage (en sÃ©quence)
        console.log('ğŸ”„ Initialisation du stockage (leaderboard)...');

        async function initializeLeaderboard() {
            try {
                // D'abord activer Supabase (charge la lib et initialise le client)
                await enableSupabaseStorage();
                console.log('âœ… Supabase activÃ© et client initialisÃ©');

                // Puis initialiser le stockage avec le client global
                await initializeSupabaseStorage();
                console.log('âœ… Stockage prÃªt (leaderboard)');
            } catch (err) {
                console.error('âŒ Erreur initialisation stockage:', err.message);
                throw err;
            }
        }

        // Lancer l'initialisation
        initializeLeaderboard();
    </script>
</head>

<body>
    <header>
        <div class="header-content">
            <h1>SV CHALLENGE LIST</h1>
            <div class="header-links">
                <a href="index.html">â† Retour Ã  la liste</a>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <!-- Stats globales -->
            <div class="global-stats">
                <div class="stat-item">
                    <div class="stat-icon">ğŸ†</div>
                    <div class="stat-info">
                        <div class="stat-label">Niveaux</div>
                        <div class="stat-value" id="statsLevels">0</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ğŸ…</div>
                    <div class="stat-info">
                        <div class="stat-label">Records</div>
                        <div class="stat-value" id="statsRecords">0</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">ï¿½</div>
                    <div class="stat-info">
                        <div class="stat-label">Participants</div>
                        <div class="stat-value" id="statsPlayers">0</div>
                    </div>
                </div>
            </div>

            <!-- Classement Global -->
            <div class="leaderboard-section">
                <div class="section-header">
                    <h2>ğŸ† Classement Global</h2>
                    <p class="section-subtitle">Meilleurs joueurs et vÃ©rificateurs</p>
                </div>

                <!-- Filtres par pays/rÃ©gion -->
                <div class="leaderboard-filters">
                    <div class="filter-group">
                        <label for="countryFilter">Pays:</label>
                        <select id="countryFilter">
                            <option value="">Tous les pays</option>
                            <option value="France">ğŸ‡«ğŸ‡· France</option>
                            <option value="Belgique">ğŸ‡§ğŸ‡ª Belgique</option>
                            <option value="Suisse">ğŸ‡¨ğŸ‡­ Suisse</option>
                            <option value="Canada">ğŸ‡¨ğŸ‡¦ Canada</option>
                            <option value="Luxembourg">ğŸ‡±ğŸ‡º Luxembourg</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="regionFilter">RÃ©gion:</label>
                        <input type="text" id="regionFilter" placeholder="Filtrer par rÃ©gion...">
                    </div>
                    <button id="resetFilters" class="btn-reset">RÃ©initialiser</button>
                </div>

                <div id="combinedLeaderboard" class="leaderboard-list"></div>
            </div>
        </div>
    </main>

    <footer>
        <p>SV Challenge List - Classements</p>
    </footer>

    <script src="submission.js"></script>
    <script src="record-submission.js"></script>
    <script src="data-sync.js"></script>
    <script src="leaderboard-manager.js"></script>
    <script src="leaderboard.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸ“Š Leaderboard: DOMContentLoaded appelÃ©');

            // Attendre que le stockage soit initialisÃ©
            let attempts = 0;
            while (!universalStorage && attempts < 100) {
                await new Promise(resolve => setTimeout(resolve, 50));
                attempts++;
            }

            if (!universalStorage) {
                console.error('âš ï¸ Stockage non initialisÃ©, utilisÃ© fallback');
            } else {
                console.log('âœ… Stockage prÃªt (', universalStorage.getCurrentAdapter(), ')');
            }

            // Charger les classements
            if (typeof loadLeaderboards === 'function') {
                await loadLeaderboards();
            }
        });
    </script>
    <script src="dark-mode.js"></script>
</body>

</html>