<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Nettoyage localStorage</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dark-mode.css">
</head>

<body>
    <header>
        <div class="header-content">
            <h1>Nettoyage du stockage local</h1>
        </div>
    </header>

    <main>
        <div class="container" style="max-width: 600px; margin: 50px auto;">
            <h2>ğŸ—‘ï¸ Supprimer localStorage</h2>
            <p style="color: #666; margin-bottom: 30px;">
                Toutes vos donnÃ©es sont maintenant dans Supabase. Vous pouvez nettoyer le stockage local de votre
                navigateur.
            </p>

            <button onclick="clearLocalStorage()" class="btn-submit" style="margin-bottom: 20px;">
                ğŸ—‘ï¸ Supprimer tout le localStorage
            </button>

            <button onclick="clearGameDataOnly()" class="btn-accept" style="margin-bottom: 20px;">
                ğŸ® Supprimer uniquement les donnÃ©es de jeu
            </button>

            <button onclick="checkStatus()" class="btn-reset">
                âœ… VÃ©rifier l'Ã©tat du stockage
            </button>

            <pre id="log" style="
                background: #f5f5f5;
                padding: 15px;
                border-radius: 5px;
                margin-top: 30px;
                font-size: 0.9em;
                color: #333;
                overflow-x: auto;
            "></pre>
        </div>
    </main>

    <script src="storage-adapter.js"></script>
    <script src="supabase-config.js"></script>
    <script src="dark-mode.js"></script>

    <script>
        const log = document.getElementById('log');

        function addLog(msg) {
            log.textContent += msg + '\n';
            console.log(msg);
        }

        function clearLocalStorage() {
            if (confirm('âš ï¸ Cela supprimera TOUT le localStorage. ÃŠtes-vous sÃ»r ?')) {
                localStorage.clear();
                sessionStorage.clear();
                addLog('âœ… localStorage complÃ¨tement vidÃ©\n');
                addLog('âœ… sessionStorage complÃ¨tement vidÃ©\n');
                addLog('\nğŸ‰ Nettoyage terminÃ© ! Vous utilisez maintenant Supabase exclusivement.');
            }
        }

        function clearGameDataOnly() {
            if (confirm('Supprimer les donnÃ©es de jeu du localStorage ?')) {
                const keysToRemove = [
                    'svChallengeSubmissions',
                    'svChallengeRecordSubmissions',
                    'svChallengeLevels',
                    'svChallengeRecords'
                ];

                let removed = 0;
                keysToRemove.forEach(key => {
                    if (localStorage.getItem(key)) {
                        localStorage.removeItem(key);
                        removed++;
                        addLog(`âœ… SupprimÃ©: ${key}`);
                    }
                });

                addLog(`\nğŸ‰ ${removed} entrÃ©es supprimÃ©es du localStorage`);
                addLog('DonnÃ©es de jeu maintenant stockÃ©es dans Supabase uniquement.');
            }
        }

        function checkStatus() {
            log.textContent = '';
            addLog('ğŸ“Š Ã‰tat du stockage:\n');

            const keys = Object.keys(localStorage);
            addLog(`ClÃ©s stockÃ©es: ${keys.length}\n`);

            keys.forEach(key => {
                const size = (localStorage.getItem(key).length / 1024).toFixed(2);
                addLog(`  â€¢ ${key}: ${size} KB`);
            });

            if (keys.length === 0) {
                addLog('\nâœ… localStorage complÃ¨tement vide!');
                addLog('Tous les donnÃ©es utilisent Supabase.');
            } else {
                addLog('\nâš ï¸ Du contenu reste dans localStorage.');
                addLog('Cliquez sur "Supprimer" pour nettoyer.');
            }
        }

        // VÃ©rifier automatiquement au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                addLog('ğŸ” VÃ©rification initiale...\n');
                checkStatus();
            }, 500);
        });
    </script>
</body>

</html>